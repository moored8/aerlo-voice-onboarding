<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Aerlo Exec – Voice Onboarding</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="font-family:system-ui,Arial;padding:30px;max-width:900px;margin:auto">

<h1>Aerlo Exec – Voice Onboarding</h1>
<p>Click start and answer by voice. At the end you’ll receive a system prompt.</p>

<button id="start" style="font-size:18px;padding:12px 16px">
  Start Voice Interview
</button>

<h3 style="margin-top:30px">YOUR SYSTEM PROMPT</h3>
<textarea id="output" style="width:100%;min-height:260px"></textarea>

<script>
let pc, dc;

document.getElementById("start").onclick = async () => {

  const sessionRes = await fetch("/api/session", { method: "POST" });
  const session = await sessionRes.json();

  pc = new RTCPeerConnection();

  const audio = document.createElement("audio");
  audio.autoplay = true;

  pc.ontrack = e => audio.srcObject = e.streams[0];

  dc = pc.createDataChannel("oai-events");

  dc.onmessage = e => {
    const msg = JSON.parse(e.data);
    if (msg.type === "response.output_text") {
      document.getElementById("output").value += msg.text + "\n";
    }
  };

  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  stream.getTracks().forEach(track => pc.addTrack(track, stream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  const sdpRes = await fetch(
    `https://api.openai.com/v1/realtime?model=${session.model}`,
    {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${session.client_secret.value}`,
        "Content-Type": "application/sdp"
      },
      body: offer.sdp
    }
  );

  const answer = {
    type: "answer",
    sdp: await sdpRes.text()
  };

  await pc.setRemoteDescription(answer);
};
</script>

</body>
</html>

