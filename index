<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aerlo Exec — Voice Onboarding</title>
</head>
<body style="font-family:system-ui,Arial;max-width:900px;margin:40px auto;padding:0 16px;">
  <h1>Aerlo Exec — Voice Onboarding</h1>
  <p>Click start. Allow microphone. The AI will speak first.</p>

  <button id="start" style="font-size:18px;padding:12px 14px;">Start Voice Interview</button>

  <h3 style="margin-top:24px;">System Prompt Output (text)</h3>
  <textarea id="out" style="width:100%;min-height:260px;"></textarea>

  <script>
    let pc;

    document.getElementById("start").onclick = async () => {
      // 1) Create peer connection
      pc = new RTCPeerConnection();

      // 2) Play AI audio
      const audio = document.createElement("audio");
      audio.autoplay = true;
      pc.ontrack = (e) => { audio.srcObject = e.streams[0]; };

      // 3) Optional: receive text events over data channel (some models emit text events)
      const dc = pc.createDataChannel("events");
      dc.onmessage = (e) => {
        try {
          const msg = JSON.parse(e.data);
          if (msg.type && msg.text) {
            document.getElementById("out").value += msg.text + "\n";
          }
        } catch {}
      };

      // 4) Capture mic
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      stream.getTracks().forEach(t => pc.addTrack(t, stream));

      // 5) Create offer
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);

      // 6) Send SDP offer to your Vercel endpoint
      const r = await fetch("/api/session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sdp: offer.sdp })
      });

      const answerSdp = await r.text();

      // 7) Set remote description
      await pc.setRemoteDescription({ type: "answer", sdp: answerSdp });
    };
  </script>
</body>
</html>
